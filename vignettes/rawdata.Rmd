---
title: "Overview of raw data"
output: html_document
---

## Accessing the data

The package contains the training and test datasets described in the
paper. You can access them directly via the `data()` function after
loading the package:

```{r}
library( ABCmonster )
data( MACCSbinary )
## The data is now available as MACCSbinary
```

Looking at the first few rows and columns gives the general idea of how
the data is structured.

```{r}
dim( MACCSbinary )
head( MACCSbinary[,1:6] )
```

The first column, `Label`, contains annotations for each drug
specifying whether the drug is more (`"Sensitive"`) or less (`"Resistant"`)
efficacious in the ABC-16 strain, relative to the parental strain.
Test data is located in the last 24 rows of `MACCSbinary` and contains `NA`s in the
`Label` column:

```{r}
tail( MACCSbinary[,1:6] )
```

Drug identity is captured in the second (`Drug`) and third
(`pubchem_id`) columns. All remaining columns contain molecular
features, which in this case consist of binary calls on whether a
particular MACCS key is present in a drug's structure.

## Visualizing the data

Let's begin by plotting a heatmap that presents and overview of the
entire dataset. We will make extensive use of
[tidy](https://www.jstatsoft.org/article/view/v059i10) data
manipulation. As the first step, we load the appropriate library and
define a palette for subsequent plots.

```{r, message=FALSE}
library( tidyverse )
ABCpal <- c("Resistant" = "tomato", "Sensitive" = "steelblue")
```

Isolate the training data by selecting the set of rows with non-`NA`
labels.

```{r}
Xtrain <- MACCSbinary %>% filter( !is.na(Label) )
HH <- Xtrain %>% select(-Label, -Drug) %>% column_to_rownames("pubchem_id") %>% as.matrix
Annots <- select( Xtrain, pubchem_id, Label ) %>% column_to_rownames( "pubchem_id" )
```

```{r fig.align="center"}
pheatmap::pheatmap( t(HH), show_rownames=FALSE, show_colnames=FALSE,
         annotation_col=Annots, annotation_names_col=FALSE, legend=FALSE,
         color=c("gray90","gray30"), annotation_colors=list(Label=ABCpal) )
```

The version of this figure in the paper includes additional
post-processing consisting of leaf order optimization and grouping of rows.

### Dimensionality reduction

Lastly, we can perform dimensionality reduction to explore the general
trends in the data.

```{r fig.align="center"}
## Compute PCA
P <- Xtrain %>% select( -Label, -Drug, -pubchem_id ) %>% prcomp() %>%
    broom::augment( Xtrain ) %>% select( Label, PC1=.fittedPC1, PC2=.fittedPC2 )

## Plot the projection onto the first two principal components
ggplot( P, aes(x=PC1, y=PC2, color=Label) ) + geom_point() +
    theme_bw() + scale_color_manual( values=ABCpal )
```
