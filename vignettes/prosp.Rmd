---
title: "Prospective validation"
output: html_document
---

As with the previous vignettes, we begin by loading the relevant libraries and data.

```{r message=FALSE}
library( tidyverse )
library( ABCmonster )
data( MACCSbinary )
```

## Making predictions on test data

We train a model and apply it to make predictions on new data.

```{r warning=FALSE, message=FALSE}
# m <- ABCtrain( MACCSbinary )      # Will use rows of MACCSbinary where Label is not-NA
# P <- ABCpredict( m, MACCSbinary ) # Will use rows of MACCSbinary where Label is NA
```

The predictions are appended to the test data in `ABCpred` column. We can examine them directly by selecting the appropriate columns.

```{r eval=FALSE}
P %>% select( ABCpred, Drug, pubchem_id )
```

```{r echo=FALSE}
# library( kableExtra )
# P %>% select( ABCpred, Drug, pubchem_id ) %>% kable("html") %>%
#   kable_styling(bootstrap_options = c("striped", "hover", "condensed"), full_width=FALSE) %>%
#   scroll_box( height="300px", box_css = "border: none; width: 35%; margin-left: auto; margin-right: auto; margin-bottom: 10px;" )
```

## Validation data

Data can be loaded directly from this package.

```{r}
data(ABCvaldata)
head(ABCvaldata)
```

```{r fig.align="center", fig.width=7, fig.height=7}
V <- ABCvaldata %>% gather( Strain, Growth, ABC16, Parental ) %>%
  mutate( Dose = match(Dose, c("0","Top/4","Top/2","Top")),
          DrugRep = str_c(Abbrev, Replicate) )
ggplot( V, aes(x=Dose, y=Growth, fill=Strain) ) +
    geom_area( alpha = 0.3, color="black", position="identity" ) + theme_bw() +
    scale_fill_manual( values = c("ABC16"="green", "Parental"="gray50") ) +
    scale_x_continuous( breaks = 1:4, labels = c("0","Top/4","Top/2","Top") ) +
    facet_wrap( ~DrugRep, nrow=8, ncol=6 ) +
    theme( axis.text.x = element_text(angle=90, vjust=0.5, hjust=1),
          strip.text.x = element_text(margin = margin(0.1,0,0.1,0,"cm")) )
```

## Evaluation of performance

UNDER DEVELOPMENT.
